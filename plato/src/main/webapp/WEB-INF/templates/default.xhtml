<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:rich="http://richfaces.org/rich">
<h:head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title><ui:insert name="title">SCAPE Planning Suite</ui:insert></title>
	<link rel="icon" type="image/png" sizes="16x16"
		href="#{resource['gfx:plato-icon-16.png']}" />
	<h:outputStylesheet name="css/screen.css" />
	<h:outputStylesheet name="css/menu.css" />
	<script src="http://code.jquery.com/jquery-latest.js"></script>

	<script type="text/javascript">
	  function getChangedflagInputs() {
	      var changedflags = new Array();
	      var forms = document.getElementsByTagName("form");
	      for (var i=0; i &lt; forms.length; i++) {
		      var changedflag = document.getElementById(forms[i].id + ':changedflag');
		      if (changedflag != null) { changedflags.push(changedflag); }
		  }
	      return changedflags;
	  }
	  function mayExit_noClick() {
	      var changedflags = getChangedflagInputs();
	      for (var i=0; i &lt; changedflags.length; i++) {
	    	  var changedflag = changedflags[i];
		      if ((changedflag.value != null) &amp;&amp; (changedflag.value != '')) { 
	             // there are some changes, stay
	             alert('There are unsaved changes, please save or discard the changes first.');
	             return false
	          }
	      }
	      return true
	  }
	  function mayExit(target) {
		  if (mayExit_noClick()) {
	          var button = document.getElementById('menuform:' + target + 'Button');
	          button.click();
	          return true
		  } else {
			  return false
		  }

	  }
	  function changed() {
          var changedflags = getChangedflagInputs();
          for (var i=0; i &lt; changedflags.length; i++) {
              changedflags[i].value="T";
          }
	      // in some places changed() is called before other funtions, make sure they are called too
	      return true;
	  }
	  function toggleLoadingOverlay() {
		  var div = jQuery('.div-overlay');
		  div.fadeToggle(150);
	  }	  
	</script>

	<ui:insert name="scripts"></ui:insert>
</h:head>
<h:body>
	<div class="div-overlay">Please wait ...</div>
	<div id="main-div">
		<div id="header">
			<div id="bear">
				<a href="#{request.contextPath}/"> <img
					src="#{resource['gfx:plato-logo.png']}" alt="Plato" height="60px" />
					<img src="#{resource['gfx:plato-version.png']}" alt="Plato-Version"
					height="60px" />
				</a>
			</div>
			<div id="scape">
				<a href="http://www.scape-project.eu/" target="_blank"><img
					src="#{resource['gfx:scape-logo.png']}" alt="SCAPE" height="60px" /></a>
			</div>
		</div>

		<div id="menu-toolbar">
			<div id="feedback">
				<h:link value="feedback" outcome="/feedback.jsf" />
			</div>
			<script type="text/javascript">
		$(document).ready(
			function() {
				//add feedback animation 
            	$('#feedback').hover(
                	function() {
                		$(this).animate({right: '+=10'}, 200, function() {});
                	}, 
                	function() {
                    	$(this).animate({right: '-=10'}, 200, function() {});
            		}
             	);

				//reset position on click 
    	        $('#feedback').click(
    	    		function() {
						$(this).css('right', '-70px');
            		}
                );
			}
		);
	</script>

			<ui:include src="/plato/shared/menu.xhtml">
				<ui:param name="viewWorkflow" value="#{viewWorkflow}" />
			</ui:include>
			<ui:remove>
				<ui:fragment rendered="#{viewWorkflowManager.active}">
					<ui:include src="/plato/shared/menu.xhtml">
						<ui:param name="viewWorkflow" value="#{viewWorkflow}" />
					</ui:include>
				</ui:fragment>
				<ui:fragment rendered="#{!viewWorkflowManager.active}">
					<ui:include src="/plato/shared/menu.xhtml">
						<ui:param name="viewWorkflow" value="null" />
					</ui:include>
				</ui:fragment>
			</ui:remove>
		</div>

		<div id="content">
			<h:form id="notificationForm">
				<a4j:outputPanel id="notifications" layout="block">
				<ui:repeat var="note" value="#{notifications.notifications}">
					<div class="alert-box #{note.source == 'Scout'?'scout':'info'}">
					<h:outputText value="#{note.message}" escape="false"  />
					 [#{note.source}<h:outputText value="#{note.timestamp}"><f:convertDateTime pattern="dd.MM.yyyy HH:mm" /></h:outputText>] 
					 
					<a4j:commandLink styleClass="close" action="#{notifications.acceptNotification(note)}" render="notifications" value="x"/>
					</div>
				</ui:repeat>
			    </a4j:outputPanel>		
			</h:form>
			<a4j:outputPanel id="messages-panel" ajaxRendered="true">
				<h:messages id="messages" globalOnly="true" showDetail="true"
					errorClass="error" warnClass="warning" infoClass="info" />
			</a4j:outputPanel>

			<ui:insert name="content">
          [Template content will be inserted here]
      </ui:insert>
		</div>

	</div>

	<div id="footer">
		(c) 2006-2014 Institute of Software Technology and Interactive
		Systems: &#171; <a
			href="mailto:plato@ifs.tuwien.ac.at?subject=[SCAPE-PlanningSuite:]">
			off-ice bears </a> &#187;
	</div>
   <c:if test="#{viewWorkflow.plan.readOnly}">
		<script type="text/javascript">
		function onPageUpdated() {
	        $('input[type != hidden],select,textarea').each(function() {
                $(this).attr({
                    'disabled': 'disabled'
                });
	        });
	        
		};
		$().ready(onPageUpdated());
		</script>
		<a4j:status id="generalStatus" onstop="javascript:onPageUpdated();" />		
	</c:if>	
    <c:if test="#{not viewWorkflow.plan.readOnly}">
		<script type="text/javascript">
		function onPageUpdated() {};
		</script>
    </c:if>

</h:body>
</html>
