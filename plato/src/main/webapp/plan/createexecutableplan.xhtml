<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:x="http://java.sun.com/jsf/composite/htmlx"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://java.sun.com/jsf/composite/plato"
	template="/WEB-INF/templates/default.xhtml"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich">

	<ui:define name="title">SCAPE Planning Suite - #{viewWorkflow.currentview.name}</ui:define>
	<ui:define name="content">

		<h1>Create executable plan</h1>

		<p:help text="What exactly is a preservation plan?"
			url="/plato/help/plan-template.pdf" />

		<h:form id="mainform">

			<h:inputText id="changedflag" value="#{createExecutablePlan.changed}"
				style="display:none" />

			<fieldset class="size-full">
				<legend class="fieldset-full-size-legend">
					<ui:include src="/plato/shared/legend_nav.xhtml" />
					When
				</legend>

				<p:inputTextArea labelText="Triggers and conditions:"
					id="triggerscond" required="false"
					input="#{createExecutablePlan.plan.executablePlanDefinition.triggersConditions}"
					touchable="#{createExecutablePlan.plan.executablePlanDefinition}" />

				<p:inputTextArea labelText="Validate and QA:" id="validateQA"
					required="false"
					input="#{createExecutablePlan.plan.executablePlanDefinition.validateQA}"
					touchable="#{createExecutablePlan.plan.executablePlanDefinition}" />
			</fieldset>

			<fieldset class="size-full">
				<legend class="fieldset-full-size-legend">
					<ui:include src="/plato/shared/legend_nav.xhtml" />
					What
				</legend>

				<p:inputText labelText="Tool:" id="recommendation" required="false"
					disabled="true"
					input="#{createExecutablePlan.plan.recommendation.alternative.name}">
					<h:outputLink
						value="#{createExecutablePlan.plan.recommendation.alternative.action.descriptor}"
						rendered="#{createExecutablePlan.plan.recommendation.alternative.action.actionIdentifier == 'myExperiment'}">
						Open in myExperiments
					</h:outputLink>
				</p:inputText>

				<p:inputText labelText="Location of records:" id="path"
					required="false"
					input="#{createExecutablePlan.plan.executablePlanDefinition.objectPath}"
					touchable="#{createExecutablePlan.plan.executablePlanDefinition}"
					rendered="#{not createExecutablePlan.collectionProfileDefined}" />

				<a4j:outputPanel
					rendered="#{createExecutablePlan.collectionProfileDefined}">
					<div class="component">
						<div class="label">Records:</div>
						<div class="input">
							<div class="paged-list">
								<rich:dataScroller for="collectionProfileElementsTable"
									maxPages="5" boundaryControls="show" fastControls="hide"
									renderIfSinglePage="false" stepControls="show" />
								<rich:dataGrid
									value="#{createExecutablePlan.collectionProfileElements}"
									var="element" id="collectionProfileElementsTable" rows="20"
									columns="1">
									<h:outputText value="#{element}" />
								</rich:dataGrid>
							</div>
						</div>
					</div>
				</a4j:outputPanel>

				<p:inputTextArea labelText="Parameters for tool:" id="parameters"
					required="false"
					input="#{createExecutablePlan.plan.executablePlanDefinition.toolParameters}"
					touchable="#{createExecutablePlan.plan.executablePlanDefinition}" />
			</fieldset>

			<fieldset class="size-full">
				<legend class="fieldset-full-size-legend">
					<ui:include src="/plato/shared/legend_nav.xhtml" />
					Executable Plan
				</legend>
				<a4j:outputPanel id="executablePlan">
					<div>
						<input type="button"
							onclick="$('#uploadT2flowExecutablePlanPanel').toggle('normal');"
							value="Upload Executable Plan" />
						<h:commandButton
							action="#{createExecutablePlan.download(createExecutablePlan.plan.executablePlanDefinition.t2flowExecutablePlan)}"
							value="Download Executable Plan"
							rendered="#{createExecutablePlan.plan.executablePlanDefinition.t2flowExecutablePlan != null and createExecutablePlan.plan.executablePlanDefinition.t2flowExecutablePlan.dataExistent}" />
					</div>
					<div id="uploadT2flowExecutablePlanPanel" class="sampleform">
						<rich:fileUpload id="uploadT2flowExecutablePlan"
							fileUploadListener="#{createExecutablePlan.uploadT2flowExecutablePlan}"
							acceptedTypes="t2flow" allowFlash="true">
							<a4j:ajax event="uploadcomplete" execute="@none"
								render="executablePlan preservationActionPlan" />
						</rich:fileUpload>
					</div>
				</a4j:outputPanel>
			</fieldset>

			<fieldset class="size-full">
				<legend class="fieldset-full-size-legend">
					<ui:include src="/plato/shared/legend_nav.xhtml" />
					Preservation action plan
				</legend>
				<a4j:outputPanel id="preservationActionPlan">
					<div>
						<h:commandButton
							action="#{createExecutablePlan.generatePreservationActionPlan()}"
							value="Generate preservation action plan"
							rendered="#{createExecutablePlan.papGenerationPossible}" />
						<h:commandButton
							action="#{createExecutablePlan.download(createExecutablePlan.plan.executablePlanDefinition.preservationActionPlan)}"
							value="Download Preservation Action Plan"
							rendered="#{createExecutablePlan.plan.executablePlanDefinition.preservationActionPlan != null and createExecutablePlan.plan.executablePlanDefinition.preservationActionPlan.dataExistent}" />
					</div>
				</a4j:outputPanel>
			</fieldset>

			<p:savediscardproceed bean="#{viewWorkflow}" />
		</h:form>

	</ui:define>
</ui:composition>